{
	"name": "StockItem_Merge_SCD2_draft",
	"properties": {
		"content": {
			"query": "USE [cdc-synapse]\nGO\n\n-- INSERT INTO [Staging].[StockItems]\n--   (\n--     [StockItemID], \n--     [StockItemName], \n--     [SupplierID], \n--     [ColorID], \n--     [UnitPackageID], \n--     [OuterPackageID],\n--     [Brand],\n--     [Size],\n--     [LeadTimeDays],\n--     [QuantityPerOuter],\n--     [IsChillerStock],\n--     [Barcode],\n--     [TaxRate],\n--     [UnitPrice],\n--     [RecommendedRetailPrice],\n--     [TypicalWeightPerUnit],\n--     [MarketingComments],\n--     [InternalComments],\n--     [Photo],\n--     [CustomFields],\n--     [Tags],\n--     [SearchDetails],\n--     [LastEditedBy],\n--     [CurrentFlag],\n--     [EffDateFrom],\n--     [EffDateTo]\n--   )\n-- SELECT \n--     [StockItemID],\n--     [StockItemName],\n--     [SupplierID],\n--     [ColorID],\n--     [UnitPackageID],\n--     [OuterPackageID],\n--     [Brand],\n--     [Size],\n--     [LeadTimeDays],\n--     [QuantityPerOuter],\n--     [IsChillerStock],\n--     [Barcode],\n--     [TaxRate],\n--     [UnitPrice],\n--     [RecommendedRetailPrice],\n--     [TypicalWeightPerUnit],\n--     [MarketingComments],\n--     [InternalComments],\n--     [Photo],\n--     [CustomFields],\n--     [Tags],\n--     [SearchDetails],\n--     [LastEditedBy],\n--     NULL,\n--     -- [ValidFrom],    --getdate()\n--     getdate(),\n--     NULL\n-- FROM [Staging].[StockItems];\n--   (\n    MERGE [Staging].[StockItems] AS tgt\n    USING\n    -- Query to return staged customer data\n    (\n        SELECT     \n        [StockItemID],\n        [StockItemName],\n        [SupplierID],\n        [ColorID],\n        [UnitPackageID],\n        [OuterPackageID],\n        [Brand],\n        [Size],\n        [LeadTimeDays],\n        [QuantityPerOuter],\n        [IsChillerStock],\n        [Barcode],\n        [TaxRate],\n        [UnitPrice],\n        [RecommendedRetailPrice],\n        [TypicalWeightPerUnit],\n        [MarketingComments],\n        [InternalComments],\n        [Photo],\n        [CustomFields],\n        [Tags],\n        [SearchDetails],\n        [LastEditedBy]\n     FROM [Landing].[StockItems]\n     ) AS src \n     (\n        [StockItemID],\n        [StockItemName],\n        [SupplierID],\n        [ColorID],\n        [UnitPackageID],\n        [OuterPackageID],\n        [Brand],\n        [Size],\n        [LeadTimeDays],\n        [QuantityPerOuter],\n        [IsChillerStock],\n        [Barcode],\n        [TaxRate],\n        [UnitPrice],\n        [RecommendedRetailPrice],\n        [TypicalWeightPerUnit],\n        [MarketingComments],\n        [InternalComments],\n        [Photo],\n        [CustomFields],\n        [Tags],\n        [SearchDetails],\n        [LastEditedBy]\n    )\n   -- Match staged customers to existing (current) dimension records\n   ON (src.StockItemID = tgt.StockItemID AND tgt.CurrentFlag = 1)\n   -- If a current record for this customer already exists, mark it as a type 2 change\n   WHEN MATCHED THEN\n     UPDATE\n     SET tgt.CurrentFlag = 0, tgt.EffDateTo = getdate()\n   -- If not, insert a new record\n   WHEN NOT MATCHED THEN\n     INSERT \n     (\n        [StockItemID], \n        [StockItemName], \n        [SupplierID], \n        [ColorID], \n        [UnitPackageID], \n        [OuterPackageID],\n        [Brand],\n        [Size],\n        [LeadTimeDays],\n        [QuantityPerOuter],\n        [IsChillerStock],\n        [Barcode],\n        [TaxRate],\n        [UnitPrice],\n        [RecommendedRetailPrice],\n        [TypicalWeightPerUnit],\n        [MarketingComments],\n        [InternalComments],\n        [Photo],\n        [CustomFields],\n        [Tags],\n        [SearchDetails],\n        [LastEditedBy],\n        [CurrentFlag],\n        [EffDateFrom],\n        [EffDateTo]\n        )\n     VALUES ([StockItemID],\n        [StockItemName],\n        [SupplierID],\n        [ColorID],\n        [UnitPackageID],\n        [OuterPackageID],\n        [Brand],\n        [Size],\n        [LeadTimeDays],\n        [QuantityPerOuter],\n        [IsChillerStock],\n        [Barcode],\n        [TaxRate],\n        [UnitPrice],\n        [RecommendedRetailPrice],\n        [TypicalWeightPerUnit],\n        [MarketingComments],\n        [InternalComments],\n        [Photo],\n        [CustomFields],\n        [Tags],\n        [SearchDetails],\n        [LastEditedBy],\n        1,\n        -- [ValidFrom],    --getdate()\n        CAST(getdate() AS BIGINT),\n        NULL\n        )\n        -- )\n        ;",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "cdc-synapse",
				"poolName": "Built-in"
			},
			"resultLimit": -1
		},
		"type": "SqlQuery"
	}
}